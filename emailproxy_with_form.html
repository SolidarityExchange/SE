<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta content="width=device-width, initial-scale=1.0" name="viewport" />
  <title>Email-to-Letter Proxy --- The Solidarity Exchange</title>
  <link href="https://fonts.googleapis.com/css2?family=EB+Garamond&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="styles.css" />
</head>
<body>

  <div class="topbar-container">
    <div class="logo">
      <a href="index.html"><img alt="Logo" src="newlogotransparent.png" /></a>
    </div>
    <div class="social-links">
      <a href="https://facebook.com" target="_blank"><img alt="Facebook" src="https://upload.wikimedia.org/wikipedia/commons/5/51/Facebook_f_logo_%282019%29.svg" /></a>
      <a href="https://x.com" target="_blank"><img alt="Twitter" src="https://upload.wikimedia.org/wikipedia/commons/c/ce/X_logo_2023.svg" /></a>
      <a href="https://instagram.com" target="_blank"><img alt="Instagram" src="https://upload.wikimedia.org/wikipedia/commons/a/a5/Instagram_icon.png" /></a>
      <a href="https://linkedin.com" target="_blank"><img alt="LinkedIn" src="https://upload.wikimedia.org/wikipedia/commons/c/ca/LinkedIn_logo_initials.png" /></a>
    </div>
  </div>

  <div class="content">
    <div class="featured-container">
      <div class="featured-header">Email-to-Letter Proxy Service</div>
      <p class="about-text">
        If you'd like us to print and mail a letter to a prisoner, use the tool below to generate a message outline. You can copy and paste this into your preferred email provider. Some people choose services like ProtonMail or Tutanota, but please do your own research and use what feels safest to you. Send your message to: <strong>letters@solidarityexchange.org</strong>
      </p>

      <label for="prisoner">Choose a prisoner:</label><br>
      <select id="prisoner" name="prisoner" onchange="generateMessage()" class="registry-search"></select>

      <div id="output" class="about-text" style="display: none; margin-top: 1em; background-color: #f3f1e1; border-radius: 6px; padding: 1em; white-space: pre-line;"></div>

      <button id="copyBtn" style="margin-top: 10px; padding: 8px 14px; font-size: 1em; background-color: #222; color: white; border: none; border-radius: 5px; cursor: pointer; display: none;">
        Copy to Clipboard
      </button>

      <div id="copyConfirm" style="display: none; margin-top: 10px; color: green; font-weight: bold;">
        ‚úÖ Copied!
      </div>
    </div>
  </div>

  <div class="grid-container">
    <div class="grid-item"><a href="registry.html">PRISONER REGISTRY</a></div>
    <div class="grid-item"><a href="support.html">SUPPORTING PRISONERS</a></div>
    <div class="grid-item"><a href="dispatch.html">THE SOLIDARITY DISPATCH</a></div>
    <div class="grid-item"><a href="aboutus.html">ABOUT US</a></div>
  </div>

  <script>
    let prisoners = [];

    fetch('./prisoners.json')
      .then(res => res.json())
      .then(data => {
        prisoners = data;
        const select = document.getElementById("prisoner");
        const output = document.getElementById("output");
        const copyBtn = document.getElementById("copyBtn");

        // Populate dropdown
        data.forEach((p, index) => {
          const option = document.createElement("option");
          option.value = p.id;
          option.textContent = `${p.name} ‚Äî ${p.state}`;
          select.appendChild(option);
        });

        // Auto-select first prisoner and show message
        if (select.options.length > 0) {
          select.selectedIndex = 0;
          generateMessage();
        }

        copyBtn.addEventListener("click", () => {
          const text = output.textContent;
          navigator.clipboard.writeText(text).then(() => {
            const confirm = document.getElementById("copyConfirm");
            confirm.style.display = "block";
            setTimeout(() => { confirm.style.display = "none"; }, 2000);
          });
        });
      })
      .catch(err => {
        console.error("Failed to load prisoners.json", err);
      });

    function generateMessage() {
      const select = document.getElementById("prisoner");
      const output = document.getElementById("output");
      const copyBtn = document.getElementById("copyBtn");
      const selectedId = select.value;
      const prisoner = prisoners.find(p => p.id === selectedId);

      if (!prisoner) {
        output.style.display = "none";
        copyBtn.style.display = "none";
        output.textContent = "";
        return;
      }

      output.style.display = "block";
      copyBtn.style.display = "inline-block";
      output.textContent =
`üìß SUBJECT LINE:
Letter for ${prisoner.name}

‚úçÔ∏è BODY:
Dear ${prisoner.name},

[Type your message here]

‚Äî Your Name

üì¨ Mailing Address:
${prisoner.mailing_address}`;
    }
  </script>

</body>
</html>
